<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:HlaeObsTools.ViewModels.Docks"
             xmlns:controls="using:HlaeObsTools.Controls"
             xmlns:conv="using:HlaeObsTools.Converters"
             x:Class="HlaeObsTools.Views.Docks.Viewport3DDockView"
             x:DataType="vm:Viewport3DDockViewModel">
    <UserControl.Resources>
        <conv:CenterOnPointConverter x:Key="CenterOnPointConverter" />
    </UserControl.Resources>
    <Border Background="#151515" Padding="4">
        <Grid>
            <controls:OpenTkViewport x:Name="Viewport"
                                     MapPath="{Binding MapObjPath}"
                                     FreecamSettings="{Binding FreecamSettings}"
                                     InputSender="{Binding InputSender}"
                                     PinScale="{Binding PinScale}"
                                     PinOffsetX="{Binding PinOffsetX}"
                                     PinOffsetY="{Binding PinOffsetY}"
                                     PinOffsetZ="{Binding PinOffsetZ}"
                                     WorldScale="{Binding WorldScale}"
                                     WorldYaw="{Binding WorldYaw}"
                                     WorldPitch="{Binding WorldPitch}"
                                     WorldRoll="{Binding WorldRoll}"
                                     WorldOffsetX="{Binding WorldOffsetX}"
                                     WorldOffsetY="{Binding WorldOffsetY}"
                                     WorldOffsetZ="{Binding WorldOffsetZ}"
                                     MapScale="{Binding MapScale}"
                                     MapYaw="{Binding MapYaw}"
                                     MapPitch="{Binding MapPitch}"
                                     MapRoll="{Binding MapRoll}"
                                     MapOffsetX="{Binding MapOffsetX}"
                                     MapOffsetY="{Binding MapOffsetY}"
                                     MapOffsetZ="{Binding MapOffsetZ}" />
            <ItemsControl ItemsSource="{Binding #Viewport.Labels}"
                          IsHitTestVisible="False"
                          Width="{Binding #Viewport.Bounds.Width}"
                          Height="{Binding #Viewport.Bounds.Height}"
                          x:CompileBindings="False">
                <ItemsControl.Styles>
                    <Style Selector="ContentPresenter">
                        <Setter Property="Canvas.Left">
                            <Setter.Value>
                                <MultiBinding Converter="{StaticResource CenterOnPointConverter}">
                                    <Binding Path="ScreenX" />
                                    <Binding RelativeSource="{RelativeSource Self}" Path="Bounds.Width" />
                                </MultiBinding>
                            </Setter.Value>
                        </Setter>
                        <Setter Property="Canvas.Top">
                            <Setter.Value>
                                <MultiBinding Converter="{StaticResource CenterOnPointConverter}">
                                    <Binding Path="ScreenY" />
                                    <Binding RelativeSource="{RelativeSource Self}" Path="Bounds.Height" />
                                </MultiBinding>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ItemsControl.Styles>
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <TextBlock Text="{Binding Text}"
                                       Foreground="#000000"
                                       FontSize="16"
                                       FontWeight="Bold"
                                       Margin="1,1,0,0" />
                            <TextBlock Text="{Binding Text}"
                                       Foreground="{Binding LabelBrush}"
                                       FontSize="16"
                                       FontWeight="SemiBold" />
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <TextBlock Text="{Binding #Viewport.StatusText}"
                       Foreground="#D0D0D0"
                       FontSize="11"
                       Margin="8"
                       IsHitTestVisible="False"
                       TextWrapping="Wrap" />
        </Grid>
    </Border>
</UserControl>
